
{% extends "base.html" %}
{% block content %}
  <h1>Ticket #{{ thread.id }} – {{ thread.subject }}</h1>
  <p>Opened by {{ thread.creator.full_name }} ({{ thread.creator.discord_tag }}) on {{ thread.created_at.strftime("%Y-%m-%d %H:%M") }}</p>

  {% if thread.is_closed %}
    <p><strong>This ticket is closed.</strong></p>
  {% else %}
    <form method="post" class="form-card">
      <label>Reply
        <textarea name="body" rows="3" required></textarea>
      </label>
      <button class="btn" type="submit">Send reply</button>
    </form>
    <form method="post" action="{{ url_for('close_support_thread', thread_id=thread.id) }}" class="inline-form">
      <button class="btn-secondary" type="submit">Close ticket</button>
    </form>
  {% endif %}

  <h2>Messages</h2>
  <div class="chat-log">
    {% for m in thread.messages %}
      <div class="chat-msg {% if m.author.is_admin or m.author.is_mentor %}staff{% else %}user{% endif %}">
        <div class="chat-meta">
          {{ m.author.full_name }} ({{ m.author.discord_tag }}) – {{ m.created_at.strftime("%Y-%m-%d %H:%M") }}
        </div>
        <div class="chat-body">{{ m.body | replace('\n', '<br>') | safe }}</div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
